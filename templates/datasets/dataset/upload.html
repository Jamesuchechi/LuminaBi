{% extends 'base.html' %}

{% block title %}Upload Dataset - LuminaBI{% endblock %}

{% block extra_css %}
<style>
    .upload-blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        animation: blob 15s infinite;
        opacity: 0.6;
    }
    .upload-blob-1 {
        width: 500px; height: 500px;
        background: radial-gradient(circle, rgba(0, 243, 255, 0.12) 0%, transparent 70%);
        top: 10%; right: 10%;
        animation-delay: 0s;
    }
    .upload-blob-2 {
        width: 400px; height: 400px;
        background: radial-gradient(circle, rgba(189, 0, 255, 0.1) 0%, transparent 70%);
        bottom: 20%; left: 5%;
        animation-delay: 5s;
    }
    
    .dropzone {
        border: 2px dashed rgba(0, 243, 255, 0.5);
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(0, 243, 255, 0.02);
    }
    
    .dropzone:hover,
    .dropzone.dragover {
        border-color: #00f3ff;
        background: rgba(0, 243, 255, 0.08);
        box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
    }
    
    .progress-bar {
        height: 8px;
        background: rgba(189, 0, 255, 0.3);
        border-radius: 4px;
        overflow: hidden;
        margin-top: 10px;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00f3ff, #bd00ff);
        width: 0%;
        transition: width 0.3s ease;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen relative py-12 px-4 sm:px-6 lg:px-8">
    <!-- Ambient Background -->
    <div class="fixed inset-0 pointer-events-none z-0">
        <div class="upload-blob upload-blob-1"></div>
        <div class="upload-blob upload-blob-2"></div>
    </div>
    
    <div class="max-w-2xl mx-auto relative z-10">
        <!-- Back Link -->
        <div class="mb-8">
            <a href="{% url 'datasets:dataset_list' %}" class="inline-flex items-center gap-2 text-neonBlue hover:text-neonPurple transition group">
                <i class="fas fa-arrow-left group-hover:-translate-x-1 transition"></i>
                <span class="font-mono text-sm">Back to Datasets</span>
            </a>
        </div>

        <!-- Header -->
        <h1 class="text-5xl font-bold text-white mb-2">Upload Dataset</h1>
        <p class="text-gray-400 mb-12">Drag & drop your file or click to select. Supported formats: {{ supported_formats|join:", " }}</p>

        <!-- Upload Card -->
        <div class="glass-panel rounded-3xl border border-white/10 overflow-hidden">
            <div class="p-8 md:p-12 space-y-8">
                <form id="upload-form" method="post" enctype="multipart/form-data" class="space-y-6">
                    {% csrf_token %}
                    
                    <!-- File Input -->
                    <div>
                        <div class="dropzone" id="dropzone">
                            <div class="pointer-events-none">
                                <i class="fas fa-cloud-arrow-up text-4xl text-neonBlue mb-4 block"></i>
                                <p class="text-white font-semibold mb-2">Drop your file here or click to browse</p>
                                <p class="text-gray-400 text-sm">Max 100MB. Supported: CSV, Excel, JSON, Text, PDF</p>
                            </div>
                            <input type="file" id="file-input" name="file" class="hidden" accept=".csv,.xlsx,.xls,.json,.txt,.pdf" required>
                        </div>
                        
                        <!-- File Preview -->
                        <div id="file-preview" class="hidden mt-4 p-4 bg-white/5 rounded-lg border border-white/10">
                            <div class="flex items-center gap-3 mb-3">
                                <i class="fas fa-file text-neonBlue text-2xl"></i>
                                <div class="flex-1">
                                    <p class="text-white font-semibold" id="preview-name"></p>
                                    <p class="text-gray-400 text-sm" id="preview-size"></p>
                                </div>
                                <button type="button" class="text-gray-400 hover:text-white" onclick="resetFile()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dataset Name -->
                    <div>
                        <label class="block text-white font-semibold mb-3">Dataset Name</label>
                        <input type="text" name="name" class="w-full px-4 py-3 rounded-lg transition" placeholder="e.g., Sales Data 2024" required>
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label class="block text-white font-semibold mb-3">Description (Optional)</label>
                        <textarea name="description" class="w-full px-4 py-3 rounded-lg transition resize-none" placeholder="Describe your dataset..." rows="4"></textarea>
                    </div>
                    
                    <!-- Submit -->
                    <button type="submit" class="w-full px-6 py-4 bg-gradient-to-r from-neonBlue to-neonPurple text-black font-bold rounded-lg hover:shadow-lg hover:shadow-neonBlue/50 transition">
                        <i class="fas fa-arrow-up mr-2"></i>Upload & Analyze
                    </button>
                </form>
            </div>
        </div>

        <!-- Tips -->
        <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass-panel p-6 rounded-xl border border-white/10">
                <div class="text-neonBlue text-2xl mb-3"><i class="fas fa-bolt"></i></div>
                <h3 class="text-white font-semibold mb-2">Auto-Analysis</h3>
                <p class="text-gray-400 text-sm">Files are automatically analyzed after upload to detect quality issues.</p>
            </div>
            <div class="glass-panel p-6 rounded-xl border border-white/10">
                <div class="text-neonPurple text-2xl mb-3"><i class="fas fa-shield-alt"></i></div>
                <h3 class="text-white font-semibold mb-2">Secure Storage</h3>
                <p class="text-gray-400 text-sm">Your data is securely stored and only you can access it.</p>
            </div>
            <div class="glass-panel p-6 rounded-xl border border-white/10">
                <div class="text-neonPink text-2xl mb-3"><i class="fas fa-cogs"></i></div>
                <h3 class="text-white font-semibold mb-2">Clean & Visualize</h3>
                <p class="text-gray-400 text-sm">Clean, transform, and create beautiful visualizations.</p>
            </div>
        </div>
    </div>
</div>

<script>
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('file-input');
const filePreview = document.getElementById('file-preview');

// Drag & Drop
dropzone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropzone.classList.add('dragover');
});

dropzone.addEventListener('dragleave', () => {
    dropzone.classList.remove('dragover');
});

dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    const files = e.dataTransfer.files;
    if (files.length) fileInput.files = files;
    updatePreview();
});

dropzone.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', updatePreview);

function updatePreview() {
    const file = fileInput.files[0];
    if (!file) return;
    
    const name = file.name;
    const size = (file.size / 1024 / 1024).toFixed(2) + ' MB';
    
    document.getElementById('preview-name').textContent = name;
    document.getElementById('preview-size').textContent = size;
    filePreview.classList.remove('hidden');
}

function resetFile() {
    fileInput.value = '';
    filePreview.classList.add('hidden');
}

// Progress indicator
document.getElementById('upload-form').addEventListener('submit', (e) => {
    const progressFill = document.getElementById('progress-fill');
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 30;
        if (progress > 90) progress = 90;
        progressFill.style.width = progress + '%';
    }, 200);
    
    window.addEventListener('beforeunload', () => clearInterval(interval));
});
</script>
{% endblock %}
